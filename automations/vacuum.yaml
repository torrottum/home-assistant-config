- id: d9acaee1-ecc9-45b9-b6f8-5e2b64ae4239
  alias: "Vacuum: start cleaning when nobody home"
  trigger:
    - platform: time
      at: "12:00:00"
    - platform: state
      entity_id: binary_sensor.someone_home
      from: "on"
      to: "off"
  condition:
    - alias: "Nobody home"
      condition: state
      entity_id: binary_sensor.someone_home
      state: "off"
    - alias: "After 11:59:00 and before 21:45"
      condition: time
      after: "11:59:00"
      before: "21:45:00"
    - alias: "Have not vacuumed today"
      condition: state
      entity_id: input_boolean.vacuumed_today
      state: "off"
  action:
    - alias: "Start robot vacuum"
      service: vacuum.start
      target:
        entity_id: vacuum.woodhouse

- id: 3edb407a-fac0-4619-9d05-0da46f929535
  alias: "Vacuum: Started cleaning"
  trigger:
    - platform: state
      entity_id: vacuum.woodhouse
      from: "docked"
      to: "cleaning"
  action:
    - alias: "Notify Telegram"
      service: notify.telegram_tor
      data:
        title: "*ðŸ¤–Woodhouse*"
        message: "I have started cleaning, sir"

- id: 6169502c-aa20-4666-941f-894c1205f19a
  alias: "Vacuum: Finished cleaning"
  trigger:
    - platform: state
      entity_id: vacuum.woodhouse
      from: "returning"
      to: "docked"
  action:
    - alias: "Notify Telgram"
      service: notify.telegram_tor
      data:
        title: "*ðŸ¤–Woodhouse*"
        message: >
          I have finished cleaning, sir. I cleaned
          {{ state_attr("vacuum.woodhouse","cleaned_area") }}
          m2 in
          {{ state_attr("vacuum.woodhouse","cleaning_time") }} mins.
          Here's the map:
        data:
          photo:
            - file: /tmp/map_image_roborock.vacuum.a10.png

    - alias: "Turn vacuumed today helper on"
      service: input_boolean.turn_on
      target:
        entity_id: input_boolean.vacuumed_today
    - alias: "Turn emptied vacuum helper off"
      service: input_boolean.turn_off
      target:
        entity_id: input_boolean.emptied_vacuum

- id: 64e6e0c5-b94d-4158-8981-8db47efaa1af
  alias: "Vacuum: Reset vacuumed today helper at 00:00"
  trigger:
    - platform: time
      at: "00:00:00"
  action:
    - alias: "Turn vacuumed today helper off"
      service: input_boolean.turn_off
      target:
        entity_id: input_boolean.vacuumed_today
