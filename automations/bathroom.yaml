- id: 82992ceb-b69b-4958-b414-33cd80842442
  alias: "TTS: Say good morning when bathroom cabinet is opened"
  mode: single
  max_exceeded: silent
  trigger:
    - platform: state
      entity_id: binary_sensor.bathroom_cabinet_door_contact
      from: "off"
      to: "on"
  condition:
    - alias: "Morning, between 06:00 and 11:00"
      condition: time
      after: "06:00:00"
      before: "11:00:00"
  action:
    - alias: "Remind to take medications and/or fill up depending on day"
      choose:
        - conditions:
            - alias: "Is it Sunday?"
              condition: time
              weekday:
                - "sun"
          sequence:
            - service: tts.cloud_say
              data:
                entity_id: "media_player.bathroom_nest_mini"
                # Good morning Tor, rememmber to take your meds and fill your organizer for next week
                message: "God morgen, Tor. Husk å ta medisin og fylle opp dosetten for neste uke"
      default:
        - service: tts.cloud_say
          data:
            entity_id: "media_player.bathroom_nest_mini"
            # Good morning Tor, rememmber to take your meds
            message: "God morgen, Tor. Husk å ta medisin"
    - delay:
        hours: 5

- id: 48eeea46-39d5-48eb-93c7-e3ef0d24c47d
  alias: "Bathroom: Blink lights after showering for 5 minutes"
  mode: single
  max_exceeded: silent
  trigger:
    - platform: numeric_state
      entity_id: sensor.bathroom_temperature_and_humidity_humidity
      above: 80
      for: "00:05:00"
  action:
    - alias: "Blink lights"
      service: light.turn_on
      data:
        flash: long
      target:
        entity_id: light.bathroom_ceiling
    - alias: "Wait for humidity to go down"
      wait_for_trigger:
        - platform: numeric_state
          entity_id: sensor.bathroom_temperature_and_humidity_humidity
          below: 80
          for: "00:01:00"

# TODO: Fix this, it's a bit wonky
- id: 76ca785d-94d4-4095-9077-e278116611dc
  alias: "Bathroom: Play radio when door is closed"
  trigger:
    - platform: state
      entity_id: binary_sensor.0x00158d0004a97645_contact
      from: "on"
      to: "off"
  condition:
    - alias: "Motion"
      condition: state
      entity_id: group.bathroom_motion
      state: "on"
  action:
    - service: media_player.play_media
      data:
        media_content_id: http://lyd.nrk.no/nrk_radio_p13_aac_h?_hdr=0
        media_content_type: music
      target:
        entity_id: media_player.bathroom_nest_mini
    - wait_for_trigger:
        - platform: state
          entity_id: binary_sensor.0x00158d0004a97645_contact
          to: "on"
    - service: media_player.media_stop
      target:
        entity_id: media_player.bathroom_nest_mini
    - wait_for_trigger:
        - platform: state
          entity_id: binary_sensor.0x00158d0004a97645_contact
          to: "off"
